Object.defineProperty(exports,"__esModule",{value:true});var _this=this;exports.default=












































watchSignInWithFacebook;var _immutable=require('immutable');var _effects=require('redux-saga/effects');var _services=require('../../services');var _Common=require('./Common');var _Common2=_interopRequireDefault(_Common);var _redux=require('../redux');var _Actions=require('../redux/Actions');var UserAccessActions=_interopRequireWildcard(_Actions);var _facebook=require('../../facebook');function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var _marked=[signInWithFacebookAsync,watchSignInWithFacebook].map(regeneratorRuntime.mark);var queryFacebookAPI=function queryFacebookAPI(path){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}return regeneratorRuntime.async(function queryFacebookAPI$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt('return',new Promise(function(resolve,reject){_facebook.FacebookSDK.api.apply(_facebook.FacebookSDK,[path].concat(args,[function(response){if(response&&!response.error){resolve(response);}else{reject(response&&response.error);}}]));}));case 1:case'end':return _context.stop();}}},null,_this);};function signInWithFacebookAsync(action){var userInfo,profile;return regeneratorRuntime.wrap(function signInWithFacebookAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return(0,_effects.put)(UserAccessActions.signInInProgress(_Common2.default.createOperationIdMap(action)));case 3:_context2.next=5;return(0,_effects.call)(_services.UserService.signInWithFacebook,action.payload.get('scope'));case 5:userInfo=_context2.sent;_context2.next=8;return queryFacebookAPI('/me',{fields:'name,email'});case 8:profile=_context2.sent;_context2.next=11;return(0,_effects.put)(UserAccessActions.signInWithFacebookSucceeded((0,_immutable.Map)({operationId:action.payload.get('operationId'),userExists:true,userInfo:{id:profile.id,name:profile.name}})));case 11:_context2.next=17;break;case 13:_context2.prev=13;_context2.t0=_context2['catch'](0);_context2.next=17;return(0,_effects.put)(UserAccessActions.signInWithFacebookFailed(_Common2.default.createErrorMap(action,_context2.t0.message)));case 17:case'end':return _context2.stop();}}},_marked[0],this,[[0,13]]);}function watchSignInWithFacebook(){return regeneratorRuntime.wrap(function watchSignInWithFacebook$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return(
(0,_effects.takeLatest)(_redux.ActionTypes.USER_ACCESS_SIGNIN_WITH_FACEBOOK,signInWithFacebookAsync));case 2:case'end':return _context3.stop();}}},_marked[1],this);}